<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/WEB-INF/templates/template.xhtml"
                xmlns:p="http://primefaces.org/ui">

  <ui:param name="title" value="Administrace článků - Obec Tršice"/>

  <ui:define name="content">
    <script>
      var Link = Quill.import('formats/link');
      class MyLink extends Link {
	  static create(value) {
	      const node = super.create(value);
	      node.removeAttribute('target');
	      return node;
	  }
      }
      Quill.register(MyLink, true);
    </script>
    
    <h2>Články, administrace</h2>
    
    <p:panelGrid layout="grid" columns="6" styleClass="ui-noborder">
      <p:column/>
      <p:column/>
      <p:column/>
      <p:column/>
      <p:column/>
      <p:commandButton id="filesButton"
		       value="Soubory"
		       type="button"/>
      <p:overlayPanel id="files"
		      for="filesButton"
		      hideEffect="fade"
		      dynamic="true"
		      my="left top"
		      at="left bottom"
		      style="width: 70%"
		      modal="false">
	<ui:include src="/WEB-INF/includes/filesHandling.xhtml"/>
      </p:overlayPanel>
    </p:panelGrid>

    <h:form>
      <p:panelGrid layout="grid" columns="6" styleClass="ui-noborder">
	<p:column/>
	<p:column/>
	<p:column/>
	<p:commandButton value="Nový článek" 
                         action="#{articlesBean.newArticle}"
			 disabled="#{!empty articlesBean.article}"
                         update="@form"
			 resetValues="true"/>
	<p:commandButton value="Smazat" 
                         action="#{articlesBean.delete}"
			 disabled="#{empty articlesBean.article}"
			 onclick="return confirm('Opravdu smazat článek: #{articlesBean.article.id}?')"
                         update="@form :growl"
			 resetValues="true"
                         immediate="true"/>
	<p:selectBooleanButton value="#{articlesBean.editSource}"
			       style="padding: 5px"
			       onLabel="HTML"
			       offLabel="Text">
	  <p:ajax update="@form"/>
	</p:selectBooleanButton>
      </p:panelGrid>

      <p:dataTable id="articles" 
                   value="#{articlesBean.articles}" 
                   emptyMessage="Nenalezen žádný výsledek."
                   selectionMode="single"
                   selection="#{articlesBean.article}"
                   rowKey="#{article.id}"
		   rows="5"
		   paginator="true"
		   paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
		   paginatorPosition="bottom"
                   var="article">
        <p:ajax event="rowSelect"
		listener="#{articlesBean.onArticleSelect}"
		update="@form"
		resetValues="true"/>
        <p:column headerText="Id článku"
		  filterBy="#{article.id}"
		  filterMatchMode="contains">
          <h:outputText value="#{article.id}"/>
        </p:column>
	<p:column headerText="Autor"
		  filterBy="#{article.changedBy.fullName}"
		  filterMatchMode="contains">
          <h:outputText value="#{article.changedBy.fullName}"/>
        </p:column>
	<p:column headerText="Změněno">
          <h:outputText value="#{article.changedAt}">
	    <f:convertDateTime type="date" pattern="dd.MM.yyyy"/>
	  </h:outputText>
        </p:column>
      </p:dataTable>

      <p:panelGrid layout="grid"
		   columns="1"
		   rendered="#{!empty articlesBean.article}"
		   styleClass="ui-noborder">
	<p:outputLabel value="Id" for="articleId"/>
	<p:inputText id="articleId" value="#{articlesBean.article.id}">
	  <f:validateLength maximum="300"/>
	</p:inputText>

	<p:outputLabel value="Text článku" for="body"/>
        <p:textEditor id="body"
		      value="#{articlesBean.body}"
		      rendered="#{!articlesBean.editSource}"
		      height="300"/>
	<p:inputTextarea rows="10"
			 cols="30"
			 value="#{articlesBean.body}"
			 rendered="#{articlesBean.editSource}"/>

	<p:panelGrid layout="grid"
		     columns="2"
		     styleClass="ui-noborder">
	  <p:commandButton value="Uložit" 
                           action="#{articlesBean.save}"
			   styleClass="default"
			   update=":growl @form"/>
	  <p:commandButton value="Zrušit" 
                           action="#{articlesBean.cancelEdit}"
			   immediate="true"
			   resetValues="true"
                           update="@form"/>
	</p:panelGrid>	
      </p:panelGrid>
    </h:form>    
  </ui:define>
</ui:composition>
